(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function s(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=s(a);fetch(a.href,i)}})();function l(e,t){const s=h();e.countrysearch.addEventListener("input",()=>{const n=e.countrysearch.value.toLowerCase();e.countrylist.innerHTML="",n&&s.filter(i=>i.toLowerCase().includes(n)).forEach(i=>{const r=document.createElement("li");r.textContent=i,r.addEventListener("click",async()=>{e.countrysearch.value=i,e.countrylist.innerHTML="",e.countrysearch.value.trim()!==""?(e.statesearch.disabled=!1,t(2)):e.statesearch.disabled=!0}),e.countrylist.appendChild(r)})})}function h(){return["Mexico","Colombia","Ecuador","Venezuela","Argentina"]}class c{constructor(t,s){this.baseUrl=t,this.apiKey=s}async getApiResponse(t,s=!0){try{const n=s?`${this.baseUrl}/${t}&${this.apiKey}`:`${this.baseUrl}/${t}`,a=await fetch(n);if(!a.ok)throw new Error("Invalid request");const i=await a.json();return console.log(`Actual response data: ${i}`),i}catch(n){return console.error(`Error ${n} trying to execute GET request service ${service}`),null}}async postApiRequest(t,s,n=!0){const a=n?`${this.baseUrl}/${t}&${this.apiKey}`:`${this.baseUrl}/${t}`,i=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!i.ok)throw new Error(`HTTP Error: ${i.status}`);return await i.json()}}const d="https://api.opencagedata.com/geocode/v1",p="e417ee4662534d1b80d237753dfa10c6";class y extends c{constructor(){super(d,`key=${p}`)}async getCityCoordsByName(t){const s=`json?q=${t}`,n=await this.getApiResponse(s);if(n!=null)return{lat:n.results[0].geometry.lat,lng:n.results[0].geometry.lng};throw new Error(`Unable to get the current coords from city ${t}`)}}const m="https://www.googleapis.com/customsearch",C="AIzaSyCVbUkLOMrbxqznJEyaYFfD8_-5SGQoa-U",w="b07bfbe04782c4376";class g extends c{constructor(){super(m,`key=${C}`),this.cx=`cx=${w}`}async getCityPicture(t,s){const n=`v1?q=${t}%20centro%20historico&searchType=image&${this.cx}`;return(await this.getApiResponse(n)).items[s].link}}const f="23ea28807622ab533c98402d400fa334",b="https://api.openweathermap.org";class v extends c{constructor(){super(b,`appid=${f}`)}async getCurrentMainWeatherInfoByCoords(t,s){const n=`data/2.5/weather?lat=${t}&lon=${s}&units=metric`,a=await this.getApiResponse(n);if(a!=null)return{name:a.name,temp:a.main.temp,description:a.weather[0].description,humidity:a.main.humidity,visibility:a.visibility,windSpeed:a.wind.speed,iconCod:a.weather[0].icon};throw new Error(`Unable to get the current weather coords for coords: ${t}, ${s}`)}}const L="https://countriesnow.space/api/v0.1";class $ extends c{constructor(){super(L)}async getSates(t){return(await this.postApiRequest("countries/states",{country:t},!1)).data.states}async getCities(t,s){return(await this.postApiRequest("countries/state/cities",{country:t,state:s},!1)).data}}const A="https://api.thecatapi.com/v1/images";class E extends c{constructor(){super(A)}async getSomeKitties(t){const s=`search?limit=${t}`;return(await this.getApiResponse(s,!1)).map(a=>a.url)}async getSomeRandomKitty(t=10){const s=this.randomNum(1,t);return(await this.getSomeKitties(t))[s]}randomNum(t,s){return Math.floor(Math.random()*(s-t+1))+t}}class u{constructor(){this.apiGeoClientInstance=new y,this.apiPictureClientInstance=new g,this.ApiWeatherClientInstance=new v,this.ApiNamesClientInstance=new $,this.ApiKittyClientInstance=new E}async getCityCurrentWeather(t){const s=await this.apiGeoClientInstance.getCityCoordsByName(t);return await this.ApiWeatherClientInstance.getCurrentMainWeatherInfoByCoords(...Object.values(s))}async getCityImage(t,s=3){let n=["png","jpg"],a=0,i=null;for(;a<s;)try{if(i=await this.apiPictureClientInstance.getCityPicture(t,a),!n.some(o=>i.toLowerCase().includes(o.toLowerCase())))throw i=null,new Error("continue trying");break}catch{a+=1}if(!i)throw new Error("Invalid request");return i}async getSatesList(t){return(await this.ApiNamesClientInstance.getSates(t)).map(n=>n.name)}async getCitiesList(t,s){return await this.ApiNamesClientInstance.getCities(t,s)}async getRandomKitty(){return await this.ApiKittyClientInstance.getSomeRandomKitty()}}async function S(e,t){const n=await new u().getSatesList(e.countrysearch.value);e.statesearch.addEventListener("input",()=>{const a=e.statesearch.value.toLowerCase();e.statelist.innerHTML="",a&&n.filter(r=>r.toLowerCase().includes(a)).forEach(r=>{const o=document.createElement("li");o.textContent=r,o.addEventListener("click",async()=>{e.statesearch.value=r,e.statelist.innerHTML="",e.statesearch.value.trim()!==""?(e.citysearch.disabled=!1,t(3)):e.citysearch.disabled=!0}),e.statelist.appendChild(o)})})}async function I(e,t){const n=await new u().getCitiesList(e.countrysearch.value,e.statesearch.value);e.citysearch.addEventListener("input",()=>{const a=e.citysearch.value.toLowerCase();e.citylist.innerHTML="",a&&n.filter(r=>r.toLowerCase().includes(a)).forEach(r=>{const o=document.createElement("li");o.textContent=r,o.addEventListener("click",async()=>{e.citysearch.value=r,e.citylist.innerHTML="",await M(r,e),t(4)}),e.citylist.appendChild(o)})})}async function M(e,t){try{await P(e,t),await x(e)}catch{console.log("Unable to update weather information")}}async function x(e){const t=new u;try{const s=await t.getCityImage(e);document.body.style.backgroundImage=`url(${s})`}catch{alert(`There is no available pictures for city ${e} :(. But hey take this nice kitty instead`);const n=await t.getRandomKitty();document.body.style.backgroundImage=`url(${n})`}}async function P(e,t){const n=await new u().getCityCurrentWeather(e),a=`https://openweathermap.org/img/wn/${n.iconCod}@2x.png`;n&&n.name?(t.cityname.textContent=`Clima en ${e}`,t.temperature.textContent=`Temperatura: ${n.temp}Â°C`,t.humidity.textContent=`Humedad: ${n.humidity}%`,t.windspeed.textContent=`Velocidad del viento: ${n.windSpeed} m/s`,t.weathericon.src=a,t.weathericon.alt=n.description):app.innerHTML="<p>NO weather information available.</p>"}function R(e,t){e.countrysearch.addEventListener("input",()=>{e.countrysearch.value.trim()==""&&(e.statesearch.value="",e.statesearch.disabled=!0,e.citysearch.value="",e.citysearch.disabled=!0,t(2))}),e.citysearch.addEventListener("input",()=>{e.statesearch.value.trim()==""&&(e.citysearch.value="",e.citysearch.disabled=!0,t(4))})}class K{constructor(t){this.fields=t,this.currentState=1}setState(t){this.currentState=t,this.executeState()}executeState(){switch(this.currentState){case 1:l(this.fields,this.setState.bind(this));break;case 2:S(this.fields,this.setState.bind(this));break;case 3:I(this.fields,this.setState.bind(this));break;case 4:R(this.fields,this.setState.bind(this));break}}}document.getElementById("app");function T(){const e=document.querySelectorAll("[data-field]");let t={};for(var s of e){var n=s.id.replace("-","");t[n]=document.getElementById(s.id)}return t}async function U(){const e=T();new K(e).executeState()}U();
